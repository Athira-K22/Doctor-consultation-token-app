<!DOCTYPE html>
<ht        .main-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border: 3px solid #333;
            border-radius: 8px;
            overflow: hidden;
        }>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book a Token - Doctor Consultation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background-color: #f8f9fa;
            color: #333;
            padding: 20px;
        }
        
        .main-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border: 3px solid #333;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .header-section {
            background: #e9ecef;
            border-bottom: 2px solid #333;
            padding: 15px;
            text-align: center;
        }
        
        .app-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .progress-bar {
            display: flex;
            justify-content: center;
            margin: 15px 0;
            gap: 20px;
        }
        
        .progress-step {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .progress-step.active {
            background: #007bff;
            color: white;
        }
        
        .progress-step.completed {
            background: #28a745;
            color: white;
        }
        
        .progress-step.inactive {
            background: #e9ecef;
            color: #6c757d;
        }
        
        .btn {
            padding: 8px 16px;
            border: 2px solid #333;
            background: #f8f9fa;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn:hover {
            background: #e9ecef;
        }
        
        .btn-home {
            background: #e2e3e5;
            border-color: #6c757d;
            color: #495057;
            font-size: 16px;
            padding: 6px 12px;
        }
        
        .btn-primary {
            background: #007bff;
            border-color: #0056b3;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
            color: white;
        }
        
        .btn-primary:disabled {
            background: #6c757d;
            border-color: #6c757d;
            color: #fff;
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-success {
            background: #28a745;
            border-color: #1e7e34;
            color: white;
        }
        
        .btn-success:hover {
            background: #1e7e34;
            color: white;
        }
        
        .step-content {
            padding: 30px;
            /* min-height: 400px; */
        }
        
        .step {
            display: none;
        }
        
        .step.active {
            display: block;
        }
        
        .step-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }
        
        /* Step 1: Location Selection */
        .location-section {
            margin-bottom: 25px;
        }
        
        .auto-detect {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 15px;
            border: 2px solid #333;
            border-radius: 4px;
            background: #f8f9fa;
        }
        
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: #ccc;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .toggle-switch.active {
            background: #007bff;
        }
        
        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }
        
        .toggle-switch.active .toggle-slider {
            transform: translateX(26px);
        }
        
        .or-divider {
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
            color: #6c757d;
        }
        
        .location-selects {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-select {
            flex: 1;
            padding: 12px;
            border: 2px solid #333;
            border-radius: 4px;
            font-family: inherit;
            font-size: 14px;
            background: white;
        }
        
        /* Step 2: Speciality Selection */
        .speciality-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .speciality-card {
            padding: 10px 0 10px 0;
            border: 2px solid #333;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .speciality-card:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }
        
        .speciality-card.selected {
            background: #007bff;
            color: white;
            border-color: #0056b3;
        }
        
        .speciality-icon {
            font-size: 2em;
            margin-bottom: 10px;
            display: block;
        }
        
        /* Step 3: Doctor List */
        .doctor-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .doctor-card {
            border: 2px solid #333;
            border-radius: 8px;
            padding: 20px;
            background: white;
        }
        
        .doctor-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .doctor-info h3 {
            margin-bottom: 5px;
            color: #333;
        }
        
        .doctor-qualification {
            color: #6c757d;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        .doctor-schedule {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        
        .schedule-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .doctor-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .location-link {
            color: #007bff;
            text-decoration: none;
            font-size: 0.9em;
        }
        
        .location-link:hover {
            text-decoration: underline;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            border-top: 2px solid #333;
            background: #f8f9fa;
        }
        
        @media (max-width: 768px) {
            .location-selects {
                flex-direction: column;
            }
            
            .speciality-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            
            .doctor-header {
                flex-direction: column;
                gap: 10px;
            }
            
            .doctor-schedule {
                flex-direction: column;
                gap: 5px;
            }
            
            .navigation {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Header Section -->
        <div class="header-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <a href="/static/index.html" class="btn btn-home">üè† Home</a>
                <div class="app-title" style="margin: 0;">Book a Token</div>
                <div style="width: 80px;"></div> <!-- Spacer for centering -->
            </div>
            
            <!-- Progress Bar -->
            <div class="progress-bar">
                <div class="progress-step active" id="step1-progress">
                    <span>1</span>
                    <span>Location</span>
                </div>
                <div class="progress-step inactive" id="step2-progress">
                    <span>2</span>
                    <span>Speciality</span>
                </div>
                <div class="progress-step inactive" id="step3-progress">
                    <span>3</span>
                    <span>Doctor</span>
                </div>
            </div>
        </div>
        
        <!-- Step Content -->
        <div class="step-content">
            <!-- Step 1: Location Selection -->
            <div class="step active" id="step1">
                <div class="step-title">üìç Select Location</div>
                
                <div class="location-section">
                    <div class="auto-detect">
                        <span>üìç Auto-detect location</span>
                        <div class="toggle-switch" id="autoDetectToggle">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    
                    <div class="or-divider">OR</div>
                    
                    <div class="location-selects" id="manualLocation">
                        <select class="form-select" id="stateSelect">
                            <option value="">Select State</option>
                            <option value="maharashtra">Maharashtra</option>
                            <option value="karnataka">Karnataka</option>
                            <option value="tamil-nadu">Tamil Nadu</option>
                            <option value="delhi">Delhi</option>
                            <option value="gujarat">Gujarat</option>
                        </select>
                        
                        <select class="form-select" id="districtSelect" disabled>
                            <option value="">Select District</option>
                        </select>
                        
                        <select class="form-select" id="citySelect" disabled>
                            <option value="">Select City</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Step 2: Speciality Selection -->
            <div class="step" id="step2">
                <div class="step-title">üè• Select Speciality</div>
                
                <div class="speciality-grid">
                    <div class="speciality-card" data-speciality="pediatrics">
                        <span class="speciality-icon">üë∂</span>
                        <div>Pediatrics</div>
                    </div>
                    <div class="speciality-card" data-speciality="surgery">
                        <span class="speciality-icon">üíâ</span>
                        <div>Surgery</div>
                    </div>
                    <div class="speciality-card" data-speciality="general">
                        <span class="speciality-icon">ü©∫</span>
                        <div>General Medicine</div>
                    </div>
                    <div class="speciality-card" data-speciality="orthopedics">
                        <span class="speciality-icon">‚öïÔ∏è</span>
                        <div>Orthopedics</div>
                    </div>
                    <div class="speciality-card" data-speciality="dermatology">
                        <span class="speciality-icon">üî¨</span>
                        <div>Dermatology</div>
                    </div>
                    <div class="speciality-card" data-speciality="ent">
                        <span class="speciality-icon">üëÇ</span>
                        <div>ENT</div>
                    </div>
                    <div class="speciality-card" data-speciality="cardiology">
                        <span class="speciality-icon">‚ù§Ô∏è</span>
                        <div>Cardiology</div>
                    </div>
                    <div class="speciality-card" data-speciality="neurology">
                        <span class="speciality-icon">üß†</span>
                        <div>Neurology</div>
                    </div>
                </div>
            </div>
            
            <!-- Step 3: Doctor List -->
            <div class="step" id="step3">
                <div class="step-title">üë®‚Äç‚öïÔ∏è Select Doctor</div>
                
                <div class="doctor-list" id="doctorList">
                    <!-- Doctors will be populated dynamically -->
                </div>
            </div>
        </div>
        
        <!-- Navigation -->
        <div class="navigation">
            <button class="btn" id="backBtn" onclick="previousStep()" style="display: none;">‚Üê Back</button>
            <div></div> <!-- Spacer -->
            <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">Next ‚Üí</button>
        </div>
    </div>
    
    <script>
        let currentStep = 1;
        let maxSteps = 3;
        let selectedLocation = {};
        let selectedSpeciality = '';
        let autoDetectEnabled = false;
        
        // Sample data
        const locationData = {
            'maharashtra': {
                'pune': ['Pune City', 'Pimpri-Chinchwad', 'Hadapsar'],
                'mumbai': ['Mumbai Central', 'Andheri', 'Bandra', 'Thane']
            },
            'karnataka': {
                'bangalore': ['Bangalore City', 'Whitefield', 'Electronic City'],
                'mysore': ['Mysore City', 'Chamundi Hills']
            }
        };
        
        const doctorData = {
            'pediatrics': [
                {
                    name: 'Dr. Anjali Rao',
                    qualification: 'MBBS, MD Pediatrics',
                    timings: '10am‚Äì2pm, 4pm‚Äì6pm',
                    tokensToday: 20,
                    tokensLeft: 5,
                    location: 'Pune City'
                },
                {
                    name: 'Dr. Priya Sharma',
                    qualification: 'MBBS, DCH',
                    timings: '9am‚Äì1pm, 3pm‚Äì5pm',
                    tokensToday: 15,
                    tokensLeft: 8,
                    location: 'Mumbai Central'
                }
            ],
            'surgery': [
                {
                    name: 'Dr. Suraj Mehta',
                    qualification: 'MS General Surgery',
                    timings: '11am‚Äì3pm',
                    tokensToday: 15,
                    tokensLeft: 2,
                    location: 'Bangalore City'
                }
            ],
            'general': [
                {
                    name: 'Dr. Rajesh Kumar',
                    qualification: 'MBBS, MD Internal Medicine',
                    timings: '8am‚Äì12pm, 2pm‚Äì6pm',
                    tokensToday: 25,
                    tokensLeft: 12,
                    location: 'Pune City'
                }
            ]
        };
        
        // Initialize
        function init() {
            updateProgressBar();
            setupEventListeners();
            // Start with Next button disabled
            updateNextButton();
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Auto-detect toggle
            document.getElementById('autoDetectToggle').addEventListener('click', toggleAutoDetect);
            
            // Location selects
            document.getElementById('stateSelect').addEventListener('change', updateDistricts);
            document.getElementById('districtSelect').addEventListener('change', updateCities);
            document.getElementById('citySelect').addEventListener('change', updateSelectedLocation);
            
            // Speciality cards
            document.querySelectorAll('.speciality-card').forEach(card => {
                card.addEventListener('click', selectSpeciality);
            });
        }
        
        // Auto-detect toggle
        function toggleAutoDetect() {
            const toggle = document.getElementById('autoDetectToggle');
            const manualLocation = document.getElementById('manualLocation');
            
            autoDetectEnabled = !autoDetectEnabled;
            toggle.classList.toggle('active', autoDetectEnabled);
            
            if (autoDetectEnabled) {
                manualLocation.style.opacity = '0.5';
                manualLocation.style.pointerEvents = 'none';
                // Simulate auto-detection
                selectedLocation = { state: 'auto', district: 'auto', city: 'Auto-detected Location' };
                
                // Clear manual selections when auto-detect is enabled
                document.getElementById('stateSelect').value = '';
                document.getElementById('districtSelect').value = '';
                document.getElementById('districtSelect').disabled = true;
                document.getElementById('citySelect').value = '';
                document.getElementById('citySelect').disabled = true;
            } else {
                manualLocation.style.opacity = '1';
                manualLocation.style.pointerEvents = 'auto';
                selectedLocation = {};
            }
            
            updateNextButton();
        }
        
        // Update districts based on state selection
        function updateDistricts() {
            const state = document.getElementById('stateSelect').value;
            const districtSelect = document.getElementById('districtSelect');
            const citySelect = document.getElementById('citySelect');
            
            districtSelect.innerHTML = '<option value="">Select District</option>';
            citySelect.innerHTML = '<option value="">Select City</option>';
            
            if (state && locationData[state]) {
                districtSelect.disabled = false;
                Object.keys(locationData[state]).forEach(district => {
                    const option = document.createElement('option');
                    option.value = district;
                    option.textContent = district.charAt(0).toUpperCase() + district.slice(1);
                    districtSelect.appendChild(option);
                });
            } else {
                districtSelect.disabled = true;
                citySelect.disabled = true;
            }
            
            updateSelectedLocation();
        }
        
        // Update cities based on district selection
        function updateCities() {
            const state = document.getElementById('stateSelect').value;
            const district = document.getElementById('districtSelect').value;
            const citySelect = document.getElementById('citySelect');
            
            citySelect.innerHTML = '<option value="">Select City</option>';
            
            if (state && district && locationData[state][district]) {
                citySelect.disabled = false;
                locationData[state][district].forEach(city => {
                    const option = document.createElement('option');
                    option.value = city;
                    option.textContent = city;
                    citySelect.appendChild(option);
                });
            } else {
                citySelect.disabled = true;
            }
            
            updateSelectedLocation();
        }
        
        // Update selected location
        function updateSelectedLocation() {
            if (!autoDetectEnabled) {
                selectedLocation = {
                    state: document.getElementById('stateSelect').value,
                    district: document.getElementById('districtSelect').value,
                    city: document.getElementById('citySelect').value
                };
            }
            updateNextButton();
        }
        
        // Select speciality
        function selectSpeciality(event) {
            // Remove selection from all cards
            document.querySelectorAll('.speciality-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selection to clicked card
            event.currentTarget.classList.add('selected');
            selectedSpeciality = event.currentTarget.dataset.speciality;
            
            console.log('Selected speciality:', selectedSpeciality); // Debug log
            
            // Update next button state immediately
            updateNextButton();
        }
        
        // Update next button state
        function updateNextButton() {
            const nextBtn = document.getElementById('nextBtn');
            
            if (currentStep === 1) {
                // For step 1: Either auto-detect is enabled OR all three location fields are selected
                const manualLocationComplete = selectedLocation.state && 
                                             selectedLocation.district && 
                                             selectedLocation.city;
                const canProceed = autoDetectEnabled || manualLocationComplete;
                
                console.log('Step 1 - Can proceed:', canProceed, 'Auto-detect:', autoDetectEnabled, 'Manual complete:', manualLocationComplete);
                
                nextBtn.disabled = !canProceed;
                
                // Visual feedback - change button style when disabled
                if (!canProceed) {
                    nextBtn.style.opacity = '0.5';
                    nextBtn.style.cursor = 'not-allowed';
                } else {
                    nextBtn.style.opacity = '1';
                    nextBtn.style.cursor = 'pointer';
                }
            } else if (currentStep === 2) {
                const canProceed = selectedSpeciality !== '';
                
                console.log('Step 2 - Can proceed:', canProceed, 'Selected speciality:', selectedSpeciality);
                
                nextBtn.disabled = !canProceed;
                
                if (!canProceed) {
                    nextBtn.style.opacity = '0.5';
                    nextBtn.style.cursor = 'not-allowed';
                } else {
                    nextBtn.style.opacity = '1';
                    nextBtn.style.cursor = 'pointer';
                }
            }
        }
        
        // Navigation functions
        function nextStep() {
            if (currentStep < maxSteps) {
                if (currentStep === 2) {
                    loadDoctors();
                }
                currentStep++;
                updateStepDisplay();
                updateProgressBar();
                // Reset and update button state for new step
                updateNextButton();
            }
        }
        
        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepDisplay();
                updateProgressBar();
                // Reset and update button state for new step
                updateNextButton();
            }
        }
        
        // Update step display
        function updateStepDisplay() {
            // Hide all steps
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            
            // Show current step
            document.getElementById(`step${currentStep}`).classList.add('active');
            
            // Update navigation buttons
            const backBtn = document.getElementById('backBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            backBtn.style.display = currentStep > 1 ? 'inline-block' : 'none';
            
            if (currentStep === maxSteps) {
                nextBtn.style.display = 'none';
            } else {
                nextBtn.style.display = 'inline-block';
                // Don't update button state here - let updateNextButton() handle it
            }
        }
        
        // Update progress bar
        function updateProgressBar() {
            for (let i = 1; i <= maxSteps; i++) {
                const progressStep = document.getElementById(`step${i}-progress`);
                progressStep.classList.remove('active', 'completed', 'inactive');
                
                if (i < currentStep) {
                    progressStep.classList.add('completed');
                } else if (i === currentStep) {
                    progressStep.classList.add('active');
                } else {
                    progressStep.classList.add('inactive');
                }
            }
        }
        
        // Load doctors based on selected speciality
        function loadDoctors() {
            const doctorList = document.getElementById('doctorList');
            const doctors = doctorData[selectedSpeciality] || [];
            
            doctorList.innerHTML = '';
            
            doctors.forEach(doctor => {
                const doctorCard = document.createElement('div');
                doctorCard.className = 'doctor-card';
                doctorCard.innerHTML = `
                    <div class="doctor-header">
                        <div class="doctor-info">
                            <h3>${doctor.name}</h3>
                            <div class="doctor-qualification">${doctor.qualification}</div>
                        </div>
                    </div>
                    <div class="doctor-schedule">
                        <div class="schedule-item">
                            <span>‚è∞</span>
                            <span>Time: ${doctor.timings}</span>
                        </div>
                        <div class="schedule-item">
                            <span>üé´</span>
                            <span>Tokens Today: ${doctor.tokensToday}</span>
                        </div>
                        <div class="schedule-item">
                            <span>üìä</span>
                            <span>Left: ${doctor.tokensLeft}</span>
                        </div>
                    </div>
                    <div class="doctor-actions">
                        <button class="btn btn-success" onclick="bookToken('${doctor.name}')">
                            Book Token
                        </button>
                        <a href="#" class="location-link" onclick="showLocation('${doctor.location}')">
                            üìç ${doctor.location}
                        </a>
                    </div>
                `;
                doctorList.appendChild(doctorCard);
            });
            
            if (doctors.length === 0) {
                doctorList.innerHTML = '<p style="text-align: center; color: #6c757d;">No doctors found for selected speciality.</p>';
            }
        }
        
        // Book token
        function bookToken(doctorName) {
            // Find the selected doctor details
            const doctors = doctorData[selectedSpeciality] || [];
            const selectedDoctorDetails = doctors.find(doctor => doctor.name === doctorName);
            
            if (selectedDoctorDetails) {
                // Store booking details in localStorage
                localStorage.setItem('selectedLocation', selectedLocation.city || 'Auto-detected');
                localStorage.setItem('selectedSpeciality', selectedSpeciality);
                localStorage.setItem('selectedDoctor', selectedDoctorDetails.name);
                localStorage.setItem('doctorQualification', selectedDoctorDetails.qualification);
                localStorage.setItem('doctorTimings', selectedDoctorDetails.timings);
                
                // Redirect to book-token page with parameters
                const params = new URLSearchParams({
                    location: selectedLocation.city || 'Auto-detected',
                    speciality: selectedSpeciality,
                    doctor: selectedDoctorDetails.name,
                    qualification: selectedDoctorDetails.qualification,
                    timings: selectedDoctorDetails.timings,
                    tokensLeft: selectedDoctorDetails.tokensLeft
                });
                
                window.location.href = `/static/book-token.html?${params.toString()}`;
            } else {
                alert('Error: Doctor details not found. Please try again.');
            }
        }
        
        // Show location
        function showLocation(location) {
            alert(`Opening map for: ${location}\n\n(This would typically open a map application)`);
        }
        
        // Initialize when page loads
        window.onload = init;
    </script>
</body>
</html>
